openapi: 3.0.0
info:
  title: Educate Global Hub API
  description: API documentation for the Educate Global Hub platform
  version: 1.0.0
  contact:
    name: API Support
    email: support@educateglobalhub.com

servers:
  - url: http://localhost:5000/api
    description: Development server
  - url: https://api.educateglobalhub.com/api
    description: Production server

security:
  - bearerAuth: []

paths:
  /v1/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user with email and password to get access and refresh tokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: "user@example.com"
                password:
                  type: string
                  description: User's password
                  example: "password123"
                rememberMe:
                  type: boolean
                  description: Whether to remember the user for extended session
                  default: false
                  example: false
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Login successful"
                  data:
                    type: object
                    properties:
                      user:
                        $ref: "#/components/schemas/User"
                      accessToken:
                        type: string
                        description: JWT access token
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      refreshToken:
                        type: string
                        description: JWT refresh token
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - invalid credentials or email not verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/create-resource:
    post:
      tags:
        - Resources
      summary: Create a new resource
      description: Create a new educational resource with files and metadata
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - title
                - description
                - resourceType
                - ageRange
                - curriculum
                - curriculumType
                - subject
                - banner
                - previews
                - files
              properties:
                title:
                  type: string
                  description: Title of the resource
                  example: "Advanced Mathematics Worksheets"
                description:
                  type: string
                  description: Detailed description of the resource
                  example: "Comprehensive worksheets covering algebra, geometry, and calculus"
                resourceType:
                  type: string
                  enum:
                    [
                      worksheet,
                      lesson_plan,
                      assessment,
                      activity,
                      presentation,
                      other,
                    ]
                  description: Type of educational resource
                  example: "worksheet"
                visibility:
                  type: string
                  enum: [public, private]
                  description: Visibility setting for the resource
                  example: "public"
                isFree:
                  type: boolean
                  description: Whether the resource is free or paid
                  example: true
                price:
                  type: number
                  description: Price of the resource (required if not free)
                  example: 9.99
                currency:
                  type: string
                  description: Currency code (required if not free)
                  example: "USD"
                saveAsDraft:
                  type: boolean
                  description: Whether to save as draft or submit for approval
                  example: false
                ageRange:
                  type: string
                  description: Target age range for the resource
                  example: "6-8 years"
                curriculum:
                  type: string
                  description: Curriculum framework
                  example: "Common Core"
                curriculumType:
                  type: string
                  description: Type of curriculum
                  example: "Mathematics"
                subject:
                  type: string
                  description: Subject area
                  example: "Mathematics"
                banner:
                  type: string
                  format: binary
                  description: Cover photo for the resource (required)
                previews:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Preview images (1-5 images)
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Main resource files (1-3 files)
      responses:
        "201":
          description: Resource created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "resource created successfully"
                  data:
                    $ref: "#/components/schemas/Resource"
        "400":
          description: Bad request - missing required fields or validation errors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/update-resource/{id}:
    put:
      tags:
        - Resources
      summary: Update an existing resource
      description: Update resource details, files, and metadata
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Updated title
                  example: "Updated Mathematics Worksheets"
                description:
                  type: string
                  description: Updated description
                type:
                  type: string
                  enum:
                    [
                      worksheet,
                      lesson_plan,
                      assessment,
                      activity,
                      presentation,
                      other,
                    ]
                  description: Updated resource type
                publishing:
                  type: string
                  enum: [public, private]
                  description: Updated visibility setting
                isFree:
                  type: boolean
                  description: Updated free/paid status
                price:
                  type: number
                  description: Updated price
                currency:
                  type: string
                  description: Updated currency
                ageRange:
                  type: string
                  description: Updated age range
                curriculum:
                  type: string
                  description: Updated curriculum
                curriculumType:
                  type: string
                  description: Updated curriculum type
                subject:
                  type: string
                  description: Updated subject
                status:
                  type: string
                  enum: [draft, pending, approved, rejected]
                  description: Status (admin only)
                coverPhoto:
                  type: string
                  format: binary
                  description: New cover photo
                previewImages:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Additional preview images
                mainFile:
                  type: string
                  format: binary
                  description: New main resource file
      responses:
        "200":
          description: Resource updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "resource updated successfully"
                  data:
                    type: object
                    properties:
                      resource:
                        $ref: "#/components/schemas/Resource"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - not authorized to update this resource
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Resource not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/update-status/{resourceId}:
    patch:
      tags:
        - Resources
      summary: Update resource status
      description: Update the approval status of a resource (admin) or submit for approval (user)
      security:
        - bearerAuth: []
      parameters:
        - name: resourceId
          in: path
          required: true
          schema:
            type: string
          description: Resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [draft, pending, approved, rejected]
                  description: New status for the resource
                  example: "approved"
      responses:
        "200":
          description: Resource status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Resource status updated successfully"
                  data:
                    type: object
                    properties:
                      resource:
                        $ref: "#/components/schemas/Resource"
        "400":
          description: Bad request - invalid status value
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - not authorized to update status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Resource not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/my-resource-page:
    get:
      tags:
        - Resources
      summary: Get user's resources
      description: Get all resources created by the authenticated user with stats
      security:
        - bearerAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Search term for resource titles
          example: "mathematics"
        - name: status
          in: query
          schema:
            type: string
            enum: [all, draft, pending, approved, rejected]
          description: Filter by resource status
          example: "approved"
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Number of resources per page
          example: 10
      responses:
        "200":
          description: Resources fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Resource status updated successfully"
                  data:
                    type: object
                    properties:
                      stats:
                        $ref: "#/components/schemas/ResourceStats"
                      resources:
                        type: array
                        items:
                          $ref: "#/components/schemas/Resource"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/delete-resource/{resourceId}:
    delete:
      tags:
        - Resources
      summary: Delete a resource
      description: Soft delete a resource (only owner or admin can delete)
      security:
        - bearerAuth: []
      parameters:
        - name: resourceId
          in: path
          required: true
          schema:
            type: string
          description: Resource ID to delete
          example: "64a1b2c3d4e5f6789abcdef0"
      responses:
        "200":
          description: Resource deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Resource deleted successfully"
                  data:
                    type: "null"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - not authorized to delete this resource
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Resource not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/search-resource:
    get:
      tags:
        - Resources
      summary: Search resources (public)
      description: Search for resources by title, description, curriculum, subject, or age range
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: "mathematics worksheets"
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Number of results to return
          example: 10
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
          example: 1
      responses:
        "200":
          description: Resources found successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Resources fetched successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Resource"
        "400":
          description: Bad request - search query is required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/get-all-resources:
    get:
      tags:
        - Resources
      summary: Get all approved resources (public)
      description: Get all approved resources for the main page with filtering and pagination
      parameters:
        - name: q
          in: query
          schema:
            type: string
          description: Search query for title or description
          example: "mathematics"
        - name: subject
          in: query
          schema:
            type: string
          description: Filter by subject
          example: "Mathematics"
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Number of resources per page
          example: 10
      responses:
        "200":
          description: Resources fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "All resources fetched"
                  data:
                    type: object
                    properties:
                      resources:
                        type: array
                        items:
                          $ref: "#/components/schemas/FormattedResource"
                      pagination:
                        $ref: "#/components/schemas/Pagination"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/resources/get-resource-by-id/{id}:
    get:
      tags:
        - Resources
      summary: Get resource by ID
      description: Get detailed information about a specific resource
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
      responses:
        "200":
          description: Resource fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Resource fetched successfully!"
                  data:
                    $ref: "#/components/schemas/DetailedResource"
        "403":
          description: Resource not available (draft/pending for non-authenticated users)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Resource not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          description: Unique user identifier
          example: "64a1b2c3d4e5f6789abcdef0"
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
        firstName:
          type: string
          description: User's first name
          example: "John"
        lastName:
          type: string
          description: User's last name
          example: "Doe"
        role:
          type: string
          enum: [teacher, school, admin]
          description: User's role
          example: "teacher"
        isEmailVerified:
          type: boolean
          description: Whether the user's email is verified
          example: true
        status:
          type: string
          enum: [active, inactive, suspended]
          description: User's account status
          example: "active"
        profileCompleted:
          type: boolean
          description: Whether the user has completed their profile
          example: true
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    Resource:
      type: object
      properties:
        _id:
          type: string
          description: Unique resource identifier
          example: "64a1b2c3d4e5f6789abcdef0"
        title:
          type: string
          description: Resource title
          example: "Advanced Mathematics Worksheets"
        description:
          type: string
          description: Resource description
          example: "Comprehensive worksheets covering algebra, geometry, and calculus"
        type:
          type: string
          enum:
            [worksheet, lesson_plan, assessment, activity, presentation, other]
          description: Type of resource
          example: "worksheet"
        isFree:
          type: boolean
          description: Whether the resource is free
          example: true
        price:
          type: number
          description: Resource price (0 if free)
          example: 0
        currency:
          type: string
          nullable: true
          description: Currency code
          example: "USD"
        publishing:
          type: string
          enum: [public, private]
          description: Visibility setting
          example: "public"
        status:
          type: string
          enum: [draft, pending, approved, rejected]
          description: Approval status
          example: "approved"
        ageRange:
          type: string
          description: Target age range
          example: "6-8 years"
        curriculum:
          type: string
          description: Curriculum framework
          example: "Common Core"
        curriculumType:
          type: string
          description: Type of curriculum
          example: "Mathematics"
        subject:
          type: string
          description: Subject area
          example: "Mathematics"
        createdBy:
          $ref: "#/components/schemas/CreatedBy"
        coverPhoto:
          $ref: "#/components/schemas/ResourceFile"
        previewImages:
          type: array
          items:
            $ref: "#/components/schemas/ResourceFile"
          description: Preview images
        mainFile:
          $ref: "#/components/schemas/ResourceFile"
        approvedBy:
          type: string
          nullable: true
          description: ID of user who approved the resource
        isDeleted:
          type: boolean
          description: Soft delete flag
          example: false
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    FormattedResource:
      type: object
      properties:
        id:
          type: string
          description: Resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
        thumbnail:
          type: string
          nullable: true
          description: Cover photo URL
          example: "https://res.cloudinary.com/example/image/upload/v1234567890/cover.jpg"
        title:
          type: string
          description: Resource title
          example: "Advanced Mathematics Worksheets"
        author:
          type: string
          description: Author name
          example: "John Doe"
        price:
          type: string
          description: Formatted price
          example: "Free"
        status:
          type: string
          description: Resource status
          example: "approved"
        flags:
          type: integer
          description: Number of flags (placeholder)
          example: 0
        uploadDate:
          type: string
          format: date-time
          description: Upload date
          example: "2023-07-01T10:30:00Z"

    DetailedResource:
      type: object
      properties:
        id:
          type: string
          description: Resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
        title:
          type: string
          description: Resource title
          example: "Advanced Mathematics Worksheets"
        description:
          type: string
          description: Resource description
          example: "Comprehensive worksheets covering algebra, geometry, and calculus"
        subject:
          type: string
          description: Subject area
          example: "Mathematics"
        age:
          type: string
          description: Age range
          example: "6-8 years"
        curriculum:
          type: string
          description: Curriculum framework
          example: "Common Core"
        price:
          type: string
          description: Formatted price
          example: "Free"
        status:
          type: string
          description: Resource status
          example: "approved"
        thumbnail:
          type: string
          nullable: true
          description: Cover photo URL
          example: "https://res.cloudinary.com/example/image/upload/v1234567890/cover.jpg"
        author:
          type: string
          description: Author name
          example: "John Doe"
        files:
          type: array
          items:
            $ref: "#/components/schemas/ResourceFile"
          description: Resource files
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp

    ResourceFile:
      type: object
      properties:
        _id:
          type: string
          description: File ID
          example: "64a1b2c3d4e5f6789abcdef1"
        resourceId:
          type: string
          description: Associated resource ID
          example: "64a1b2c3d4e5f6789abcdef0"
        fileType:
          type: string
          enum: [cover, preview, main]
          description: Type of file
          example: "cover"
        url:
          type: string
          description: File URL
          example: "https://res.cloudinary.com/example/image/upload/v1234567890/file.pdf"
        publicId:
          type: string
          description: Cloudinary public ID
          example: "educate-hub/resources/64a1b2c3d4e5f6789abcdef0/cover"
        format:
          type: string
          description: File format
          example: "pdf"
        size:
          type: integer
          description: File size in bytes
          example: 1024000
        uploadedBy:
          type: string
          description: User ID who uploaded the file
          example: "64a1b2c3d4e5f6789abcdef2"

    CreatedBy:
      type: object
      properties:
        userId:
          type: string
          description: User ID
          example: "64a1b2c3d4e5f6789abcdef2"
        role:
          type: string
          enum: [teacher, school, admin]
          description: User role
          example: "teacher"

    ResourceStats:
      type: object
      properties:
        totalResources:
          type: integer
          description: Total number of resources created by user
          example: 15
        totalSales:
          type: integer
          description: Total number of sales
          example: 45
        currentBalance:
          type: number
          description: Current wallet balance
          example: 125.50

    Pagination:
      type: object
      properties:
        total:
          type: integer
          description: Total number of items
          example: 100
        page:
          type: integer
          description: Current page number
          example: 1
        pages:
          type: integer
          description: Total number of pages
          example: 10

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: Error message
          example: "Resource not found"
        error:
          type: string
          description: Detailed error information
          example: "Validation failed"
